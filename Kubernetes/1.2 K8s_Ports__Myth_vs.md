# 1.2 : Declaring Container Ports in Pods

https://drive.google.com/file/d/1yYMw000jMYmwQ2B88Y471PPlHWq5ygHA/view?usp=sharing

### üîç Why Declare `ports` in a Pod?

> üö® Important:
> 
> 
> Declaring `containerPort` **does NOT publish the port** outside the cluster (like `-p` in Docker).
> 
> It‚Äôs **documentation + integration aid** for:
> 
> - Services (to know which port to target)
> - Tools like `kubectl port-forward`
> - Network policies
> - Human readability

Kubernetes **does not block** traffic if you omit `ports` ‚Äî your app can still listen on any port. But **best practice = always declare it**.

---

### üîß YAML Comparison

### ‚úÖ `pod-with-ports.yml` (Minimal)

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nnwebserver
spec:
  containers:
    - name: nnwebserver
      image: lovelearnlinux/webserver:v1
      ports:
        - containerPort: 80
          name: http
          protocol: TCP

```

### ‚úÖ `pod-simple-with-ports.yml` (Realistic + Namespace)

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nnappone
  namespace: learning        # ‚Üê New! Isolates resources
  labels:
    app: nnappone            # ‚Üê Used by Services/selectors
spec:
  containers:
    - name: networknuts-app
      image: lovelearnlinux/webserver:v1
      ports:
        - containerPort: 80
          name: http
          protocol: TCP

```

> üí° Key Additions in pod-simple-with-ports.yml:
> 
> - **`namespace: learning`**: Scopes the Pod to a custom namespace (not `default`).
> - **`labels`**: Critical for later (Services, Deployments).
> - **Comments**: Explain the full workflow ‚Äî excellent for labs!

---

### üìå Core Concepts Covered

| Concept | Why It Matters |
| --- | --- |
| **`containerPort`** | Tells Kubernetes which port the app listens on (for introspection). |
| **`name: http`** | Allows referencing the port by name (e.g., in Services: `targetPort: http`). |
| **`protocol: TCP`** | Default is TCP, but you can use UDP (e.g., for DNS, streaming). |
| **Namespace** | Logical cluster partition ‚Äî avoids naming conflicts, enables multi-tenancy. |
| **Labels** | Foundation for **Service discovery** (`selector: { app: nnappone }`). |

---

### üß™ Unified Lab: Deploy Pod with Ports & Test Connectivity

> We‚Äôll use pod-simple-with-ports.yml since it includes namespace + labels.
> 

### üîß Step-by-Step

```bash
# 1. Create the 'learning' namespace
kubectl create namespace learning

# 2. Deploy the Pod
kubectl apply -f pod-simple-with-ports.yml

# 3. Verify it's running
kubectl get pods -n learning
# Should show: nnappone   1/1     Running

# 4. Get Pod IP and Node
kubectl describe pod nnappone -n learning | grep -E "IP:|Node:"

# Example output:
# IP:           10.244.0.5
# Node:         minikube/192.168.49.2

# 5. OPTION A: Test from inside the cluster (using another Pod)
kubectl run tester --image=curlimages/curl -it --rm -- sh -n learning
# Inside shell:
curl <http://10.244.0.5>
# ‚Üí Should return "Welcome to Network Nuts!"

# 6. OPTION B: Port-forward to your local machine
kubectl port-forward pod/nnappone 8080:80 -n learning
# Then open browser or run:
curl <http://localhost:8080>

# 7. Clean up
kubectl delete pod nnappone -n learning
kubectl delete namespace learning

```

> üí° Why not curl directly from your laptop to Pod IP?
> 
> 
> Pod IPs are **only reachable from inside the cluster** (unless you‚Äôre on the node and have network access). That‚Äôs why we use `port-forward` or a **temporary tester Pod**.
> 

---

### ‚ùì Common Questions

**Q: What if I don‚Äôt specify `ports`?**

A: The app still runs! But tools won‚Äôt know which port it uses. Services may fail if `targetPort` isn‚Äôt set correctly.

**Q: Can I expose multiple ports?**

A: Yes! Just add more entries:

```yaml
ports:
  - containerPort: 80
    name: http
  - containerPort: 443
    name: https

```

**Q: Does `containerPort` open a firewall?**

A: **No.** Kubernetes doesn‚Äôt enforce port filtering based on this field.

---

### ‚û°Ô∏è Summary

‚úÖ Declaring `ports` is **best practice** (even if optional).

‚úÖ Use **meaningful names** (`http`, `metrics`) for port references.

‚úÖ **Namespaces** isolate workloads (great for labs, teams, environments).

‚úÖ **Labels** enable service discovery ‚Äî don‚Äôt skip them!

‚úÖ Test Pod connectivity using `port-forward` or a **debug Pod**.