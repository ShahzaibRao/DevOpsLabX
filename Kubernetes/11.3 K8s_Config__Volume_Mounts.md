# **11.3 : Mount ConfigMap or Secret as Files (Volume Mount)**

https://drive.google.com/file/d/13CuKvbDSEXqsM3CFP3X0bE_ETn5QMcdf/view?usp=sharing

### üéØ What It Is

Instead of injecting config or secrets as **environment variables**, you can **mount them as files** inside a container ‚Äî ideal for config files like `nginx.conf`, `app.yaml`, or SSL certificates.

> ‚úÖ Why? Many apps expect config in files, not env vars ‚Äî and files can auto-update when the ConfigMap/Secret changes!
> 

### üí° Real-World Analogy

> Like placing a configuration file (/etc/myapp/config.ini) on your server ‚Äî but Kubernetes manages it for you and updates it automatically.
> 

---

### üß™ Example: Mount a ConfigMap as an Nginx Config File

**Step 1: Create a ConfigMap with a config file**

```yaml
# nginx-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-conf
  namespace: dev
data:
  nginx.conf: |
    server {
      listen 80;
      location / {
        return 200 "Hello from ConfigMap!\n";
        add_header Content-Type text/plain;
      }
    }

```

Apply it:

```bash
kubectl apply -f nginx-config.yaml

```

**Step 2: Mount It as a File in a Pod**

```yaml
# nginx-pod.yaml
apiVersion: v1
kind: Pod
meta
  name: nginx
  namespace: dev
spec:
  containers:
  - name: nginx
    image: nginx
    volumeMounts:
    - name: config-volume
      mountPath: /etc/nginx/conf.d  # Nginx auto-loads .conf files here
  volumes:
  - name: config-volume
    configMap:
      name: nginx-conf

```

Apply and test:

```bash
kubectl apply -f nginx-pod.yaml
kubectl port-forward nginx -n dev 8080:80 &
curl <http://localhost:8080>
# Output: Hello from ConfigMap!

```

‚úÖ **Bonus**: If you update the ConfigMap, the file in the Pod **auto-updates in ~1 minute**!

---

### ‚úÖ Summary YAML

```yaml
# Mount ConfigMap as files
volumes:
- name: config-vol
  configMap:
    name: my-config

# Mount Secret as files
volumes:
- name: secret-vol
  secret:
    secretName: my-secret

# In container
volumeMounts:
- name: config-vol
  mountPath: /etc/app/config

```

> üîç Each key in the ConfigMap/Secret becomes a file with that name.
> 

---

### ‚ùì Common Questions

**Q: Are files auto-updated when ConfigMap changes?**

‚úÖ **Yes!** Kubernetes updates the files in the volume **every ~1 minute** (but your app must reload the config).

**Q: Can I mount a single key as a file with a different name?**

‚úÖ Yes! Use `items`:

```yaml
configMap:
  name: my-config
  items:
  - key: nginx.conf
    path: default.conf  # file will be named default.conf

```

**Q: What if I mount over a directory that already has files?**

‚ö†Ô∏è The entire directory is **replaced**! Use `subPath` to mount a single file without overwriting:

```yaml
volumeMounts:
- name: config-vol
  mountPath: /etc/nginx/nginx.conf
  subPath: nginx.conf

```

**Q: Do Secrets mounted as files have proper permissions?**

‚úÖ Yes! Default file permissions = `644`. You can change with `defaultMode`:

```yaml
secret:
  secretName: my-secret
  defaultMode: 400  # read-only for owner

```

---

### üõ†Ô∏è Best Practices

1. ‚úÖ Use **volume mounts** for **config files**, **certificates**, or **scripts**.
2. ‚úÖ Use **`subPath`** to mount a **single file** without wiping the whole directory.
3. ‚úÖ For apps that **don‚Äôt auto-reload config**, combine with a **sidecar** that watches and signals reload.
4. ‚úÖ Prefer **ConfigMap for config files**, **Secret for certs/keys**.
5. ‚úÖ Never store **real secrets in Git** ‚Äî even in ConfigMap/Secret YAML.