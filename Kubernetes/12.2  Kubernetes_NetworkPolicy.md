# 12.2 : Allow Traffic from Specific Pods (Ingress Rules)**

### üéØ What It Is

A **NetworkPolicy ingress rule** lets you **allow traffic only from specific Pods** (e.g., ‚Äúonly frontend can talk to backend‚Äù).

> ‚úÖ This is the most common use case for NetworkPolicy in microservices apps.
> 

### üí° Real-World Analogy

> Like a VIP list at a club:
> 
> - Only guests with a **green wristband** (`app: frontend`) can enter the **VIP room** (`app: backend`)

---

### üß™ Example: Allow Only `frontend` to Access `backend`

**Assume you already have:**

- A `frontend` Deployment (label: `app: frontend`)
- A `backend` Deployment (label: `app: backend`)
- **Cilium or Calico** installed (NetworkPolicy enabled)

**Step 1: Apply a NetworkPolicy to Allow Only `frontend`**

```yaml
# allow-frontend-to-backend.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
meta
  name: allow-frontend-to-backend
  namespace: default
spec:
  podSelector:
    matchLabels:
      app: backend          # ‚Üê Policy applies to backend Pods
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: frontend     # ‚Üê Only Pods with this label can connect
    ports:
    - protocol: TCP
      port: 80

```

Apply it:

```bash
kubectl apply -f allow-frontend-to-backend.yaml

```

**Step 2: Test Access**

‚úÖ **From frontend ‚Üí backend (should work):**

```bash
kubectl exec deploy/frontend -- curl -m 3 <http://backend>
# ‚úÖ Returns HTTP response

```

‚ùå **From any other Pod ‚Üí backend (should fail):**

```bash
# Create a test Pod (not labeled as frontend)
kubectl run tester --image=busybox --rm -it -- sh
/ # wget -qO- <http://backend>
# ‚ùå Hangs or times out

```

‚úÖ **Result**: Only `frontend` can reach `backend`!

---

### ‚úÖ Summary YAML

```yaml
spec:
  podSelector:
    matchLabels:
      app: target
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: allowed-source
    ports:
    - port: 80

```

> üîë Key Fields:
> 
> - `podSelector` in **policy spec**: Which Pods are **protected**?
> - `podSelector` in **ingress.from**: Which Pods are **allowed**?

---

### ‚ùì Common Questions

**Q: What if the `frontend` is in a different namespace?**

‚û°Ô∏è Use `namespaceSelector`:

```yaml
ingress:
- from:
  - namespaceSelector:
      matchLabels:
        env: prod
    podSelector:
      matchLabels:
        app: frontend

```

**Q: Can I allow traffic from a Service?**

‚ùå No! NetworkPolicy works at **Pod level**, not Service level.

‚úÖ Use the **Pod labels** that the Service selects.

**Q: Does this work with headless Services?**

‚úÖ Yes! NetworkPolicy applies to **Pod IPs**, not Services.

**Q: What protocol does it support?**

‚û°Ô∏è **TCP, UDP, SCTP** (but most use TCP for HTTP).

---

### üõ†Ô∏è Best Practices

1. ‚úÖ **Always label Pods clearly**:
    
    ```yaml
    labels:
      app: frontend
      tier: web
    
    ```
    
2. ‚úÖ **Use `ports` to restrict to specific ports** (don‚Äôt allow all)
3. ‚úÖ **Start with deny-all**, then add allow rules (least privilege)
4. ‚úÖ **Test with a generic Pod** (like `busybox`) to verify isolation
5. ‚úÖ **Combine with namespace labels** for multi-tenant clusters:
    
    ```yaml
    namespaceSelector:
      matchLabels:
        team: dev
    
    ```
    

---