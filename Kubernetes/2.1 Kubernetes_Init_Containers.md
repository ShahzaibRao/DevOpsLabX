# 2.1 : Init Containers

 

https://drive.google.com/file/d/19ytBZF5JEkP5J1j1nnpysHYnfuu9UBiR/view?usp=sharing

### ğŸ” What Is an Init Container?

> âœ… Init Containers are special containers that run before the main app containers in a Pod.
> 
> - They **must complete successfully** before the main app starts.
> - Used for **setup tasks**: download config, wait for DB, generate certs, run migrations, etc.
> - They **do not run concurrently** with app containers.

> ğŸ’¡ Think of them as the "pre-flight checklist" for your app.
> 

---

### ğŸ”§ YAML Breakdown (`cow-say-with-init.yml`)

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  restartPolicy: Always
  volumes:
    - name: data
      emptyDir: {}
  initContainers:
    - name: nginx-init
      image: busybox
      command: ["/bin/sh", "-c"]
      args:
        - echo "<pre>Hello Kubernetes</pre>" > /data/index.html
      volumeMounts:
        - name: data
          mountPath: /data
  containers:
    - name: nginx
      image: nginx:1.11
      volumeMounts:
        - name: data
          mountPath: /usr/share/nginx/html

```

### ğŸ§© Key Components Explained

| Section | Purpose |
| --- | --- |
| **`volumes: - name: data`** | Creates an **emptyDir volume** (temporary storage on the node). Lives as long as the Pod. |
| **`initContainers`** | Runs **first**. Uses `docker/whalesay` (a fun image with `cowsay`). |
| **`command + args`** | Runs shell command: generates a **cow saying "Hello Kubernetes"** â†’ saves as `index.html`. |
| **`volumeMounts` (init)** | Mounts `data` volume at `/data` â†’ writes `index.html` there. |
| **`containers` (main app)** | Runs **nginx**, which serves static files from `/usr/share/nginx/html`. |
| **`volumeMounts` (nginx)** | Mounts the **same `data` volume** â†’ so it serves the `index.html` created by init! |

> ğŸ¯ Result: When you visit the nginx Pod, you see a cow saying "Hello Kubernetes" â€” generated at startup by the init container!
> 

---

### ğŸ“Œ Why This Pattern Matters (Real-World Use Cases)

| Scenario | How Init Containers Help |
| --- | --- |
| **Wait for DB** | Run a script that pings DB until ready â†’ then start app. |
| **Fetch config** | Download secrets/config from Vault or Git before app starts. |
| **Migrate DB** | Run `rails db:migrate` before launching Rails app. |
| **Generate certs** | Create TLS certs for the main app to use. |

> âœ… Advantage over sidecar: Init containers run once and exit â€” no resource waste.
> 

---

### ğŸ§ª Lab: Deploy the Cow-Say Pod & See the Magic

### ğŸ”§ Steps

```bash
# 1. Apply the Pod
kubectl apply -f cow-say-with-init.yml

# 2. Watch the Pod phases
kubectl get pods -w
# You'll see:
# nginx   0/1   Init:0/1   â†’ then â†’ nginx   1/1   Running

# 3. Once running, port-forward to access nginx
kubectl port-forward pod/nginx 8080:80

# 4. Open browser or run:
curl <http://localhost:8080>

# ğŸ® You should see:
#  _______________________
# < Hello Kubernetes! >
#  -----------------------
#         \\   ^__^
#          \\  (oo)\\_______
#             (__)\\       )\\/\\
#                 ||----w |
#                 ||     ||

```

### ğŸ” Observe Init Container Logs

```bash
# View init container logs (even after it exits!)
kubectl logs nginx -c nginx-init

# View main nginx logs
kubectl logs nginx

```

### ğŸ§¹ Clean Up

```bash
kubectl delete pod nginx

```

---

### â“ Common Questions

**Q: What if the init container fails?**

A: The Pod stays in `Init:0/1` state. Kubernetes **retries** based on `restartPolicy` (here: `Always`). Fix the issue â†’ it will retry.

**Q: Can I have multiple init containers?**

A: **Yes!** They run **sequentially** (one after another). Great for multi-step setup.

**Q: Why use `emptyDir`?**

A: Itâ€™s a simple, fast, **ephemeral** volume. Perfect for sharing data **within a Pod**. Data is lost when Pod dies.

**Q: Can init containers access the network?**

A: **Yes!** They have full network access (unlike some security-restricted environments).

---

### â¡ï¸ Summary

âœ… **Init containers** run **before** main app containers.

âœ… Theyâ€™re ideal for **setup, validation, or data prep**.

âœ… Use **volumes** (like `emptyDir`) to **share data** between init and app containers.

âœ… They **must succeed** for the Pod to move to `Running`.

âœ… Real-world uses: config fetch, DB wait, migrations, cert gen.