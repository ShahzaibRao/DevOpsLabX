# 2.2 : Environment Variables in Pods

https://drive.google.com/file/d/1xAabKlDCuoqRAZPzLVA36AR1dXOe3_1c/view?usp=sharing

### üîç YAML Breakdown

```yaml
apiVersion: v1
kind: Pod
meta
  name: dbpod
spec:
  containers:
  - name: mysql
    image: mysql:latest          # ‚ö†Ô∏è Not recommended for production!
    ports:
    - containerPort: 3329        # ‚ö†Ô∏è Non-standard MySQL port!
    env:
    - name: MYSQL_ROOT_PASSWORD
      value: "redhat"            # ‚ö†Ô∏è Plaintext password!

```

### ‚úÖ What It Does

- Launches a **MySQL database** container.
- Sets the **root password** via the `MYSQL_ROOT_PASSWORD` environment variable (required by the official MySQL image).
- Exposes **port 3329** (instead of default 3306 ‚Äî likely to avoid conflict).

> üí° The official MySQL Docker image reads MYSQL_ROOT_PASSWORD at startup to initialize the database.
> 

---

### üìå Key Concepts

| Concept | Explanation |
| --- | --- |
| **`env`** | Injects environment variables into the container. |
| **`name` / `value`** | Simple key-value pair. Great for **non-sensitive** config. |
| **Security Warning** | **Never store real secrets in YAML!** Use **Secrets** (we‚Äôll cover this soon). |
| **Image Tag `:latest`** | Avoid in production! Use **specific versions** (`mysql:8.0`) for reproducibility. |
| **Non-standard port (3329)** | Useful for labs to avoid port conflicts, but confusing. Standard MySQL = **3306**. |

---

### üîê Best Practice: Use Kubernetes **Secrets** (Preview)

Instead of:

```yaml
env:
- name: MYSQL_ROOT_PASSWORD
  value: "redhat"

```

‚úÖ **Do this** (we‚Äôll cover full Secret creation later):

```yaml
env:
- name: MYSQL_ROOT_PASSWORD
  valueFrom:
    secretKeyRef:
      name: mysql-secret
      key: password

```

> üîí Why?
> 
> - Secrets are **base64-encoded** (not encrypted by default, but can be with etcd encryption).
> - They can be **mounted as files** or **injected as env vars**.
> - Git repos won‚Äôt leak passwords if you use external secret management (Vault, AWS Secrets Manager, etc.).

---

### üß™ Lab: Deploy MySQL Pod with Env Var (Safely!)

> ‚ö†Ô∏è Warning: This uses a plaintext password ‚Äî only for learning! Never do this in production.
> 

### üîß Steps

```bash
# 1. Apply the Pod
kubectl apply -f pod-with-env-variable.yml

# 2. Check status (MySQL takes ~20-30 sec to initialize)
kubectl get pods -w
# Wait until STATUS = Running

# 3. View logs to confirm startup
kubectl logs dbpod

# 4. Connect to MySQL from another Pod (temporary client)
kubectl run mysql-client --image=mysql:8.0 -it --rm --restart=Never -- \\
  mysql -h dbpod -P 3329 -uroot -predhat

# You should get a MySQL prompt!
# Type: \\q to quit

# 5. Clean up
kubectl delete pod dbpod

```

> üí° Why connect via Pod name (dbpod)?
> 
> 
> Kubernetes DNS allows Pods in the same namespace to resolve each other by **name**.
> 

---

### ‚ùì Common Questions

**Q: Can I use multiple env vars?**

A: Yes! Just add more entries:

```yaml
env:
- name: MYSQL_ROOT_PASSWORD
  value: "redhat"
- name: MYSQL_DATABASE
  value: "myapp"
- name: MYSQL_USER
  value: "appuser"
- name: MYSQL_PASSWORD
  value: "apppass"

```

**Q: What if I forget `MYSQL_ROOT_PASSWORD`?**

A: The MySQL container **will not start** ‚Äî it‚Äôs required.

**Q: Can env vars reference other env vars?**

A: Not directly in Pod spec ‚Äî but you can use **`envFrom` + ConfigMap/Secret**, or handle it in your app.

---

### ‚û°Ô∏è Summary

‚úÖ Use `env` to inject **configuration** into containers.

‚úÖ Official images (MySQL, PostgreSQL, Redis) often **require env vars** for setup.

‚ö†Ô∏è **Never hardcode secrets** in YAML ‚Äî use **Kubernetes Secrets**.

‚ö†Ô∏è Avoid `:latest` ‚Äî use **specific image tags**.

‚úÖ Test connectivity using a **temporary client Pod**.