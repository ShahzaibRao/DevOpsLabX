# 6.2 : Imperative vs Declarative Deployments

https://drive.google.com/file/d/1H1E5ZmpeUGX-fgF4_kl85a0QnShOWGW1/view?usp=sharing

### ğŸ” Script Breakdown (`imperative-deployment.sh`)

```bash
#!/bin/sh
# A: Create Deployment with latest nginx
kubectl create deployment nginx-imperative --image=nginx:latest

# B: Scale to 3 replicas
kubectl scale deployment/nginx-imperative --replicas=3

# C & D: Add metadata annotations
kubectl annotate deployment/nginx-imperative environment=prod
kubectl annotate deployment/nginx-imperative organization=sales

```

> ğŸ”‘ Key Insight:
> 
> 
> This script uses **imperative commands** â€” you tell Kubernetes **what to do step-by-step**.
> 

---

### ğŸ“Œ Imperative vs Declarative: Core Differences

| Aspect | **Imperative** (`kubectl create ...`) | **Declarative** (`kubectl apply -f ...`) |
| --- | --- | --- |
| **Approach** | "Do this, then that" | "Hereâ€™s the desired state â€” make it so" |
| **Audit Trail** | âŒ Hard to track changes | âœ… Full history in Git |
| **Reproducibility** | âŒ Manual steps | âœ… `git clone && kubectl apply` |
| **Team Collaboration** | âŒ Error-prone | âœ… Code-reviewed YAML |
| **Rollback** | âŒ Manual | âœ… `git revert && kubectl apply` |
| **Use Case** | Quick testing, learning | **Production, GitOps, CI/CD** |

> âœ… Kubernetes Best Practice:
> 
> 
> **Use declarative YAML for production**
> 
> Use imperative for **quick experiments**
> 

---

### ğŸ§ª k3s Lab: Run Imperative Script & Compare

### ğŸ”§ Step 1: Run the Script

```bash
# Make script executable
chmod +x imperative-deployment.sh

# Run it
./imperative-deployment.sh

# Verify
kubectl get deployments
# NAME                  READY   UP-TO-DATE   AVAILABLE
# nginx-imperative      3/3     3            3

kubectl describe deployment nginx-imperative | grep -A 2 Annotations
# Annotations:
#   environment: prod
#   organization: sales

```

### ğŸ”§ Step 2: Export to YAML (See What Was Created)

```bash
# Get the full Deployment spec
kubectl get deployment nginx-imperative -o yaml > nginx-imperative.yaml

# View key parts
grep -A 5 "replicas\\|image\\|annotations" nginx-imperative.yaml

```

> ğŸ” Youâ€™ll see:
> 
> 
> ```yaml
> replicas: 3
> template:
>   spec:
>     containers:
>     - image: nginx:latest
> annotations:
>   environment: prod
>   organization: sales
> 
> ```
> 

### ğŸ”§ Step 3: Try to "Recreate" Declaratively

> ğŸ’¡ Now you have a YAML file â€” you could version-control it!
> 

```bash
# Delete imperative Deployment
kubectl delete deployment nginx-imperative

# Recreate from YAML
kubectl apply -f nginx-imperative.yaml

# Result: Identical Deployment!

```

> âœ… This is the power of declarative:
> 
> 
> Once you have YAML, youâ€™re in **GitOps territory**.
> 

---

### âš ï¸ Critical Warning: `:latest` Tag

Your script uses:

```bash
--image=nginx:latest

```

> ğŸš¨ Never use :latest in production!
> 
> - **Non-deterministic**: `latest` changes over time
> - **Breaks rollbacks**: You canâ€™t go back to "previous latest"
> - **Security risk**: Unknown image version

> âœ… Fix: Always use specific tags:
> 
> 
> ```bash
> kubectl create deployment nginx --image=nginx:1.25
> 
> ```
> 

---

### ğŸ’¡ When to Use Imperative Commands

| Scenario | Command |
| --- | --- |
| **Quick test** | `kubectl create deployment test --image=busybox` |
| **Debugging** | `kubectl scale deployment/app --replicas=0` |
| **One-off tasks** | `kubectl annotate pod/p1 owner=john` |
| **Learning** | Great for exploring CLI |

> ğŸ¯ Rule of Thumb:
> 
> 
> If youâ€™ll **do it more than once**, **write YAML**.
> 

---

### â“ Common Questions

**Q: Can I mix imperative and declarative?**

A: âš ï¸ **Dangerous!** If you `kubectl apply -f` then `kubectl scale`, the next `apply` will **overwrite the scale** (unless you use `--server-side` or `kubectl scale` consistently).

**Q: How do I see the effective state?**

A: Use `kubectl get -o yaml` â€” it shows the **live state**, regardless of how it was created.

**Q: Whatâ€™s the `--dry-run=client` trick?**

A: Generate YAML without applying:

```bash
kubectl create deployment nginx --image=nginx:1.25 --dry-run=client -o yaml > deployment.yaml

```

**Q: Are annotations stored in etcd?**

A: âœ… Yes! Theyâ€™re part of the object metadata â€” visible in `kubectl get -o yaml`.

---

### â¡ï¸ Summary

âœ… **Imperative** = CLI commands (`kubectl create`, `scale`, `annotate`)

âœ… **Declarative** = YAML files (`kubectl apply -f`)

âš ï¸ **Avoid `:latest`** â€” use specific image tags

ğŸ” **Export imperative workloads to YAML** for reproducibility

ğŸ› ï¸ **Use imperative for learning/testing, declarative for production**