# 9.1: `emptyDir` Volumes (Ephemeral Storage)

https://drive.google.com/file/d/1FHkmwfdfCk3luxpZiid3_RgPJWvYpqeC/view?usp=sharing

### ğŸ” YAML Breakdown

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: empty-pod
spec:
  containers:
  - name: boxone
    image: lovelearnlinux/webserver:v1
    volumeMounts:
    - mountPath: /var/www/html  # â† Where volume is mounted in container
      name: demo-volume
  volumes:
  - name: demo-volume           # â† Volume name (matches volumeMounts)
    emptyDir: {}                # â† Ephemeral storage on node

```

> ğŸ”‘ Key Insight:
> 
> 
> `emptyDir` creates a **temporary directory on the node** that:
> 
> - Is **shared across containers** in the same Pod
> - **Survives container restarts**
> - Is **deleted when the Pod is deleted**

> ğŸ’¡ Why mount to /var/www/html?
> 
> 
> The `lovelearnlinux/webserver:v1` image likely serves files from this directory.
> 
> â†’ `emptyDir` **replaces the default content** with an empty directory!
> 

---

### ğŸ“Œ When to Use `emptyDir`

| Use Case | Why |
| --- | --- |
| **Scratch space** | Temporary files (e.g., sorting, processing) |
| **Shared communication** | Share data between containers in a Pod |
| **Cache directory** | Store non-critical cached data |
| **Log aggregation** | Sidecar container reads logs from app container |

> âš ï¸ When NOT to use emptyDir:
> 
> - **Stateful data** (databases, user uploads) â†’ use **PersistentVolume**
> - **Data that must survive Pod deletion** â†’ use **PVC**

---

### ğŸ§ª k3s Lab: Test `emptyDir` Behavior

### ğŸ”§ Step 1: Deploy the Pod

```bash
# Apply Pod
kubectl apply -f empty-dir.yaml

# Verify
kubectl get pods empty-pod

```

### ğŸ”§ Step 2: Observe Empty Web Directory

```bash
# Check web content (should be empty!)
kubectl exec empty-pod -- ls /var/www/html
# (no output = empty directory)

# Try to access web server
kubectl port-forward empty-pod 8080:80 &
curl <http://localhost:8080>
# âœ… Returns empty response (no index.html)

```

> ğŸ” Why?
> 
> 
> The `emptyDir` **overwrote** the imageâ€™s default `/var/www/html` (which had `index.html`).
> 

### ğŸ”§ Step 3: Write Data to `emptyDir`

```bash
# Create a file in the volume
kubectl exec empty-pod -- sh -c "echo '<h1>Hello from emptyDir!</h1>' > /var/www/html/index.html"

# Verify
kubectl exec empty-pod -- cat /var/www/html/index.html

# Test via port-forward
curl <http://localhost:8080>
# âœ… "Hello from emptyDir!"

```

### ğŸ”§ Step 4: Simulate Container Restart (Data Survives)

```bash
# Kill the container (not the Pod!)
kubectl exec empty-pod -- kill 1

# Wait for container to restart
kubectl get pods empty-pod

# Check if data survives
curl <http://localhost:8080>
# âœ… Still "Hello from emptyDir!" â†’ data survived container restart!

```

### ğŸ”§ Step 5: Delete Pod (Data Lost)

```bash
# Delete Pod
kubectl delete pod empty-pod

# Recreate Pod
kubectl apply -f empty-dir.yaml

# Check content
curl <http://localhost:8080>
# âŒ Empty again! â†’ `emptyDir` is ephemeral.

```

### ğŸ”§ Step 6: Clean Up

```bash
kubectl delete pod empty-pod

```

---

### ğŸ’¡ Real-World `emptyDir` Examples

| Scenario | YAML Snippet |
| --- | --- |
| **Shared logs** | App writes to `/var/log`, sidecar reads from same `emptyDir` |
| **Temporary processing** | Download file â†’ process â†’ upload result |
| **Cache directory** | `mountPath: /app/cache` |

> âœ… Best Practices:
> 
> - Use `emptyDir.medium: Memory` for **tmpfs** (RAM-backed, faster):
>     
>     ```yaml
>     emptyDir:
>       medium: Memory
>       sizeLimit: "100Mi"
>     
>     ```
>     
> - **Never store critical data** in `emptyDir`

---

### ğŸ†š `emptyDir` vs Persistent Volumes

| Feature | **`emptyDir`** | **PersistentVolume** |
| --- | --- | --- |
| **Lifetime** | Pod lifetime | Independent of Pod |
| **Survives Pod delete** | âŒ No | âœ… Yes |
| **Node migration** | âŒ Stuck to node | âœ… Moves with Pod (if supported) |
| **Use Case** | Temporary data | Stateful apps (DBs, file storage) |

> ğŸ’¡ Your next files (pod-with-volume.yml, persistent-volume-nfs.yaml) will cover persistent storage.
> 

---

### â“ Common Questions

**Q: Where is `emptyDir` stored on the node?**

A: In the **kubeletâ€™s data directory** (e.g., `/var/lib/kubelet/pods/<pod-id>/volumes/...`).

**Q: Can I use `emptyDir` with multiple containers?**

A: âœ… **Yes!** (Your next file `empty-dir-multiple` will show this.)

**Q: Does `emptyDir` consume node disk space?**

A: âœ… **Yes!** It uses the nodeâ€™s filesystem (or RAM if `medium: Memory`).

**Q: Whatâ€™s the default size limit?**

A: **No limit** (uses available disk space). Set `sizeLimit` to cap it.

---

### â¡ï¸ Summary

âœ… **`emptyDir`** = ephemeral storage for **temporary data**

âœ… **Survives container restarts**, **not Pod deletion**

âœ… **Shared across containers** in the same Pod

ğŸ” In k3s: Test by **writing data** â†’ **restart container** â†’ **delete Pod**

â¡ï¸ Next: **Multiple containers sharing `emptyDir`** (`empty-dir-multiple`)